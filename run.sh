#!/bin/bash

set -e

# ==========================================================
# 1. 환경 설정 및 패키지 설치
# ==========================================================

# 프로젝트 디렉토리로 이동합니다. (경로가 다르면 이 부분을 수정하세요)
echo "프로젝트 디렉토리로 이동합니다: ~/sblm"
cd ~/sblm

# ✅ 수정된 부분: 스크립트가 있는 폴더로 한 단계 더 들어갑니다.
echo "스크립트 폴더로 이동합니다: ver1_stage1"
cd ver1_stage1

# (선택 사항) 가상 환경 활성화
# 가상 환경을 사용하시는 경우, 아래 줄의 주석(#)을 제거하여 활성화하세요.
# echo "가상 환경을 활성화합니다..."
# source venv/bin/activate

# requirements.txt에 명시된 패키지를 설치합니다.
echo "요구사항 패키지를 설치합니다..."
pip install -r requirements.txt

# ✅ Optuna-XGBoost 연동 패키지를 설치합니다.
echo "Optuna-XGBoost 연동 패키지를 설치합니다..."
pip install "optuna-integration[xgboost]"

# TabPFN을 별도로 설치합니다. (최초 1회만 필요)
echo "TabPFN을 설치합니다..."
pip install "git+https://github.com/automl/TabPFN@main"

# ==========================================================
# 2. 파이썬 스크립트 실행
# ==========================================================
# "테스트 모드"로 실행하려면 아래 코드의 주석을 풀고, "일반 모드"는 주석 처리하세요.
# echo "main.py 스크립트를 실행합니다 (🔥 테스트 모드)..."
# python main.py --stage stage1 --seed 2025 --test_mode

# "일반 모드"로 실행하려면 아래 코드의 주석을 풀고, "테스트 모드"는 주석 처리하세요.
echo "main.py 스크립트를 실행합니다 (일반 모드)..."
python main.py --stage stage1 --seed 2025 --trials 50


# ==========================================================
# 4. 스크립트 실행 완료 메시지
# ==========================================================

echo "스크립트 실행이 완료되었습니다."

